<div class="row">
	<div class="setting-menu">
    <div class="menu-block">
      <a class="menu-link" href="#">Summary</a>
      <div class="divider"></div>
      <div class="width-100 state-div">
        <table class="width-100 state-table">
          <tr class="font-size-14">
            <td class="width-25">State</td>
            <td class="width-25 text-right">Online</td>
            <td class="width-25 text-right">Offline</td>
            <td class="width-25 text-right">Total</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-25">รอจัด</td>
            <td class="width-25 text-right" id="online-3">-</td>
            <td class="width-25 text-right" id="offline-3">-</td>
            <td class="width-25 text-right" id="total-3">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-25r">กำลังจัด</td>
            <td class="width-25 text-right" id="online-4">-</td>
            <td class="width-25 text-right" id="offline-4">-</td>
            <td class="width-25 text-right" id="total-4">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-25">รอตรวจ</td>
            <td class="width-25 text-right" id="online-5">-</td>
            <td class="width-25 text-right" id="offline-5">-</td>
            <td class="width-25 text-right" id="total-5">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-25">กำลังตรวจ</td>
            <td class="width-25 text-right" id="online-6">-</td>
            <td class="width-25 text-right" id="offline-6">-</td>
            <td class="width-25 text-right" id="total-6">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-25">รอส่ง</td>
            <td class="width-25 text-right" id="online-7">-</td>
            <td class="width-25 text-right" id="offline-7">-</td>
            <td class="width-25 text-right" id="total-7">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-25">ส่งแล้ว</td>
            <td class="width-25 text-right" id="online-8">-</td>
            <td class="width-25 text-right" id="offline-8">-</td>
            <td class="width-25 text-right" id="total-8">-</td>
          </tr>
          <tr class="font-size-14" style="background-color:black; color:white;">
            <td class="width-25">Total</td>
            <td class="width-25 text-right" id="online-sum">-</td>
            <td class="width-25 text-right" id="offline-sum">-</td>
            <td class="width-25 text-right" id="total-sum">-</td>
          </tr>
        </table>
      </div>
    </div>

    <div class="menu-block">
      <a class="menu-link" href="#">TIKTOK</a>
      <div class="divider"></div>
      <div class="width-100 state-div">
        <table class="width-100 state-table">
          <tr class="font-size-14">
            <td class="width-50">State</td>
            <td class="width-50 text-right">Total</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">รอจัด</td>
            <td class="width-50 text-right" id="tiktok-3">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">กำลังจัด</td>
            <td class="width-50 text-right" id="tiktok-4">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">รอตรวจ</td>
            <td class="width-50 text-right" id="tiktok-5">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">กำลังตรวจ</td>
            <td class="width-50 text-right" id="tiktok-6">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">รอส่ง</td>
            <td class="width-50 text-right" id="tiktok-7">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">ส่งแล้ว</td>
            <td class="width-50 text-right" id="tiktok-8">-</td>
          </tr>
          <tr class="font-size-14" style="background-color:black; color:white;">
            <td class="width-50">Total</td>
            <td class="width-50 text-right" id="tiktok-sum">-</td>
          </tr>
        </table>
      </div>
    </div>

    <div class="menu-block">
      <a class="menu-link" href="#">SHOPEE</a>
      <div class="divider"></div>
      <div class="width-100 state-div">
        <table class="width-100 state-table">
          <tr class="font-size-14">
            <td class="width-50">State</td>
            <td class="width-50 text-right">Total</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">รอจัด</td>
            <td class="width-50 text-right" id="shopee-3">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">กำลังจัด</td>
            <td class="width-50 text-right" id="shopee-4">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">รอตรวจ</td>
            <td class="width-50 text-right" id="shopee-5">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">กำลังตรวจ</td>
            <td class="width-50 text-right" id="shopee-6">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">รอส่ง</td>
            <td class="width-50 text-right" id="shopee-7">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">ส่งแล้ว</td>
            <td class="width-50 text-right" id="shopee-8">-</td>
          </tr>
          <tr class="font-size-14" style="background-color:black; color:white;">
            <td class="width-50">Total</td>
            <td class="width-50 text-right" id="shopee-sum">-</td>
          </tr>
        </table>
      </div>
    </div>

    <div class="menu-block">
      <a class="menu-link" href="#">LAZADA</a>
      <div class="divider"></div>
      <div class="width-100 state-div">
        <table class="width-100 state-table">
          <tr class="font-size-14">
            <td class="width-50">State</td>
            <td class="width-50 text-right">Total</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">รอจัด</td>
            <td class="width-50 text-right" id="lazada-3">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">กำลังจัด</td>
            <td class="width-50 text-right" id="lazada-4">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">รอตรวจ</td>
            <td class="width-50 text-right" id="lazada-5">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">กำลังตรวจ</td>
            <td class="width-50 text-right" id="lazada-6">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">รอส่ง</td>
            <td class="width-50 text-right" id="lazada-7">-</td>
          </tr>
          <tr class="font-size-14">
            <td class="width-50">ส่งแล้ว</td>
            <td class="width-50 text-right" id="lazada-8">-</td>
          </tr>
          <tr class="font-size-14" style="background-color:black; color:white;">
            <td class="width-50">Total</td>
            <td class="width-50 text-right" id="lazada-sum">-</td>
          </tr>
        </table>
      </div>
    </div>

	</div>
</div><!--/ row  -->

<input type="hidden" id="refresh-time-ms" value="60000" />

<script>
  const HOME = '<?php echo $this->home; ?>/';
  const syncChannels = ['offline', 'online', 'tiktok', 'shopee', 'lazada'];
  const syncState = ['3', '4', '5', '6', '7', '8'];

  window.addEventListener('load', () => {
    let delay = parseDefault(parseInt($('#refresh-time-ms').val()), 300000); //--- refresh every 5 minutes
    getData();
    var sync = setInterval(function() {
      getData();
    }, delay);
  });

  function getData() {
    load_in();
    syncState.forEach(function(state) {
      syncChannels.forEach(function(channels) {
        console.log('channels : '+channels + ', state : '+state);
        count_orders(channels, state);
      })
    })

    load_out();
  }


  function count_orders(channels, state) {
    setTimeout(() => {
      $.ajax({
        url:HOME + 'count_orders',
        type:'GET',
        cache:false,
        data:{
          'channels' : channels,
          'state' : state
        },
        success:function(rs) {
          if(isJson(rs)) {
            let ds = JSON.parse(rs);

            if(ds.status == 'success') {
              let rows = parseDefault(parseInt(ds.rows), 0);
              rows = rows > 0 ? addCommas(rows) : '-';
              $('#'+channels+'-'+state).text(rows);

              if(channels == 'online' || channels == 'offline') {
                setTimeout(() => {
                  totalSummary();
                }, 200);
              }
              else {
                setTimeout(() => {
                  calcTotal(channels);
                }, 200);
              }
            }
          }
        },
        error:function(rs) {

        }
      })
    }, 1000);
  }

  function calcTotal(channels) {
    let sum = 0;

    syncState.forEach(function(state) {
      let qty = parseDefault(parseInt(removeCommas($('#'+channels+'-'+state).text())), 0);
      sum += qty;
    });

    $('#'+channels+'-sum').text(addCommas(sum));
  }


  // function calcSummary() {
  //   let sum = 0;
  //   syncState.forEach(function(state) {
  //     let qty = parseDefault(parseInt(removeCommas($('#total-'+state).text())), 0);
  //     sum += qty;
  //   });
  //
  //   $('#total-sum').text(addCommas(sum));
  // }

  function totalSummary() {
    let sum = 0;
    let online_sum = 0;
    let offline_sum = 0;

    syncState.forEach(function(state) {
      let online = parseDefault(parseInt(removeCommas($('#online-'+state).text())), 0);
      let offline = parseDefault(parseInt(removeCommas($('#offline-'+state).text())), 0);
      let total = online + offline;
      online_sum += online;
      offline_sum += offline;
      $('#total-'+state).text(addCommas(total));
      sum += total;
    });

    $('#online-sum').text(addCommas(online_sum));
    $('#offline-sum').text(addCommas(offline_sum));
    $('#total-sum').text(addCommas(sum));
  }


  // function calcTotal(state) {
  //   let offline = parseDefault(parseInt(removeCommas($('#offline-'+state).text())), 0);
  //   let online = parseDefault(parseInt(removeCommas($('#online-'+state).text())), 0);
  //   let total = offline + online;
  //   total = total > 0 ? addCommas(total) : '-';
  //
  //   $('#total-'+state).text(total);
  // }
</script>
